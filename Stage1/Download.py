import os
import hashlib
import csv
import requests
import subprocess
import Stage1.Log as Logger
import Stage1.GlobalVariables as var

def mkDir(dir):
    dir = dir.split('/')
    try:
        if os.name == 'nt':
            tmp = 'C:\\'
            for i in dir:
                tmp += i + "\\"
                try:
                    os.mkdir(tmp)
                except FileExistsError:
                    continue
            return tmp
        else:
            tmp = '/tmp/'
            for i in dir:
                tmp += i + "/"
                try:
                    os.mkdir(tmp)
                except FileExistsError:
                    continue
            return tmp
    except:
        return False


def download(url):
    try:
        newFolders = '/'.join(''.join(url.split('/master')[1:]).split('/')[1:-1])
        mkDir(var.rootDir + newFolders)
        tmp = var.rootDir + url.split("/master")[-1].split("/")[-1]
        print(12)
        with open(tmp,"wb") as f:
            print(2222)
            #f.write(requests.get(url).content)
            f.close()
            print(222)
            Logger.Log('a','b')
        return tmp

    except:
        return False

def checkIntegrity(filename,url):
    sha256sumFile = download(url)
    try:
        with open(sha256sumFile, 'r') as file:
            reader = csv.reader(file)
            sha256sumDict = {rows[0]: rows[1] for rows in reader}
        os.remove(sha256sumFile)
        with open(filename,'rb') as file:
            bytes = file.read()
        sha256sum = hashlib.sha256(bytes).hexdigest()
        if(sha256sumDict.get(filename) == sha256sum):
            return  True
        else:
            return False

    except:
        return False


exe = download("https://github.com/E1i0t/qwertyuiopasdfghjklzxcvbnm/raw/master/test.exe")
#print(exe)
#subprocess.run([exe],shell=False)